<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ API - My Doctor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #14B8A6 0%, #2563EB 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #14B8A6;
            margin-bottom: 30px;
            text-align: center;
        }

        .test-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .test-section h3 {
            color: #1f2937;
            margin-bottom: 15px;
        }

        .result {
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .success {
            background: #dcfce7;
            border: 2px solid #10b981;
            color: #065f46;
        }

        .error {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }

        .info {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            color: #1e40af;
        }

        button {
            background: linear-gradient(135deg, #14B8A6, #2563EB);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            opacity: 0.9;
        }

        .api-url {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .api-url input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-right: 10px;
        }

        .badge-success {
            background: #10b981;
            color: white;
        }

        .badge-error {
            background: #ef4444;
            color: white;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ API</h1>

        <div class="api-url">
            <label for="apiUrl"><strong>Ø±Ø§Ø¨Ø· API:</strong></label>
            <input type="text" id="apiUrl" value="https://my-doctor-api-wf84.onrender.com/api">
            <button onclick="updateApiUrl()" style="margin-top: 10px;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        </div>

        <!-- Test 1: Health Check -->
        <div class="test-section">
            <h3>1. ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h3>
            <button onclick="testHealth()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <div id="healthResult"></div>
        </div>

        <!-- Test 2: Get Specialties -->
        <div class="test-section">
            <h3>2. Ø¬Ù„Ø¨ Ø§Ù„ØªØ®ØµØµØ§Øª</h3>
            <button onclick="testGetSpecialties()">Ø¬Ù„Ø¨ Ø§Ù„ØªØ®ØµØµØ§Øª</button>
            <div id="specialtiesResult"></div>
        </div>

        <!-- Test 3: Get Doctors -->
        <div class="test-section">
            <h3>3. Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</h3>
            <button onclick="testGetDoctors()">Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡</button>
            <div id="doctorsResult"></div>
        </div>

        <!-- Test 4: Admin Login -->
        <div class="test-section">
            <h3>4. ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
            <p>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <strong>admin</strong> | ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: <strong>admin123</strong></p>
            <button onclick="testAdminLogin()">Ø§Ø®ØªØ¨Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <div id="loginResult"></div>
        </div>

        <!-- Test 5: Add Doctor -->
        <div class="test-section">
            <h3>5. Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ (Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)</h3>
            <button onclick="testAddDoctor()">Ø¥Ø¶Ø§ÙØ© Ø·Ø¨ÙŠØ¨ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
            <div id="addDoctorResult"></div>
        </div>

        <!-- Test 6: Reset Database -->
        <div class="test-section" style="border: 3px solid #ef4444;">
            <h3 style="color: #ef4444;">âš ï¸ 6. Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø®Ø·ÙŠØ±!)</h3>
            <p style="color: #991b1b; font-weight: bold;">ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª ÙˆØ§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙˆØ§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª!</p>
            <button onclick="testResetDatabase()" style="background: #ef4444;">Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <div id="resetResult"></div>
        </div>
    </div>

    <script>
        let API_URL = 'https://my-doctor-api-wf84.onrender.com/api';
        let authToken = null;

        function updateApiUrl() {
            API_URL = document.getElementById('apiUrl').value;
            showResult('healthResult', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· API', 'info');
        }

        function showResult(elementId, message, type) {
            const resultDiv = document.getElementById(elementId);
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        async function testHealth() {
            showResult('healthResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');

            try {
                const response = await fetch(`${API_URL.replace('/api', '')}/health`);
                const data = await response.json();

                if (response.ok) {
                    showResult('healthResult',
                        `<span class="status-badge badge-success">âœ“ Ù†Ø¬Ø­</span>\n` +
                        `Ø§Ù„Ø­Ø§Ù„Ø©: ${data.status}\n` +
                        `Ø§Ù„Ø®Ø¯Ù…Ø©: ${data.service}\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: ${response.status}`,
                        'success'
                    );
                } else {
                    showResult('healthResult',
                        `<span class="status-badge badge-error">âœ— ÙØ´Ù„</span>\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${response.status}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('healthResult',
                    `<span class="status-badge badge-error">âœ— Ø®Ø·Ø£</span>\n` +
                    `Ø§Ù„Ø®Ø·Ø£: ${error.message}\n\n` +
                    `ØªÙØ§ØµÙŠÙ„: Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¬Ø­ Ù…Ø´ÙƒÙ„Ø© CORS Ø£Ùˆ Ø§Ù„Ø®Ø§Ø¯Ù… ØºÙŠØ± Ù…ØªØµÙ„`,
                    'error'
                );
            }
        }

        async function testGetSpecialties() {
            showResult('specialtiesResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');

            try {
                const response = await fetch(`${API_URL}/specialties`);
                const data = await response.json();

                if (response.ok) {
                    showResult('specialtiesResult',
                        `<span class="status-badge badge-success">âœ“ Ù†Ø¬Ø­</span>\n` +
                        `Ø¹Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµØ§Øª: ${data.length}\n` +
                        `Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${JSON.stringify(data, null, 2)}`,
                        'success'
                    );
                } else {
                    showResult('specialtiesResult',
                        `<span class="status-badge badge-error">âœ— ÙØ´Ù„</span>\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${response.status}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('specialtiesResult',
                    `<span class="status-badge badge-error">âœ— Ø®Ø·Ø£</span>\n` +
                    `Ø§Ù„Ø®Ø·Ø£: ${error.message}`,
                    'error'
                );
            }
        }

        async function testGetDoctors() {
            showResult('doctorsResult', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...', 'info');

            try {
                const response = await fetch(`${API_URL}/doctors`);
                const data = await response.json();

                if (response.ok) {
                    showResult('doctorsResult',
                        `<span class="status-badge badge-success">âœ“ Ù†Ø¬Ø­</span>\n` +
                        `Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡: ${data.length}\n` +
                        `Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${JSON.stringify(data, null, 2)}`,
                        'success'
                    );
                } else {
                    showResult('doctorsResult',
                        `<span class="status-badge badge-error">âœ— ÙØ´Ù„</span>\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${response.status}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('doctorsResult',
                    `<span class="status-badge badge-error">âœ— Ø®Ø·Ø£</span>\n` +
                    `Ø§Ù„Ø®Ø·Ø£: ${error.message}`,
                    'error'
                );
            }
        }

        async function testAdminLogin() {
            showResult('loginResult', 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...', 'info');

            try {
                const response = await fetch(`${API_URL}/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    authToken = data.access_token;
                    showResult('loginResult',
                        `<span class="status-badge badge-success">âœ“ Ù†Ø¬Ø­</span>\n` +
                        `ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!\n` +
                        `Ø§Ù„Ù…Ø¯ÙŠØ±: ${data.admin.username}\n` +
                        `Ø§Ù„Ø¨Ø±ÙŠØ¯: ${data.admin.email}\n` +
                        `Token: ${authToken.substring(0, 20)}...`,
                        'success'
                    );
                } else {
                    showResult('loginResult',
                        `<span class="status-badge badge-error">âœ— ÙØ´Ù„</span>\n` +
                        `Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${data.detail}\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${response.status}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('loginResult',
                    `<span class="status-badge badge-error">âœ— Ø®Ø·Ø£</span>\n` +
                    `Ø§Ù„Ø®Ø·Ø£: ${error.message}`,
                    'error'
                );
            }
        }

        async function testAddDoctor() {
            if (!authToken) {
                showResult('addDoctorResult',
                    'ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!',
                    'error'
                );
                return;
            }

            showResult('addDoctorResult', 'Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨...', 'info');

            try {
                const response = await fetch(`${API_URL}/doctors`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name: 'Ø¯ÙƒØªÙˆØ± Ø§Ø®ØªØ¨Ø§Ø± ' + Date.now(),
                        specialty_id: 1,
                        phone: '0599123456',
                        email: 'test@example.com',
                        bio: 'Ø·Ø¨ÙŠØ¨ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±'
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showResult('addDoctorResult',
                        `<span class="status-badge badge-success">âœ“ Ù†Ø¬Ø­</span>\n` +
                        `ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­!\n` +
                        `Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${JSON.stringify(data, null, 2)}`,
                        'success'
                    );
                } else {
                    showResult('addDoctorResult',
                        `<span class="status-badge badge-error">âœ— ÙØ´Ù„</span>\n` +
                        `Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${data.detail}\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${response.status}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('addDoctorResult',
                    `<span class="status-badge badge-error">âœ— Ø®Ø·Ø£</span>\n` +
                    `Ø§Ù„Ø®Ø·Ø£: ${error.message}`,
                    'error'
                );
            }
        }

        async function testResetDatabase() {
            if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!\n\nØ³ÙŠØªÙ… Ø­Ø°Ù:\n- Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ®ØµØµØ§Øª\n- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡\n- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                return;
            }

            showResult('resetResult', 'Ø¬Ø§Ø±ÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');

            try {
                const response = await fetch(`${API_URL}/admin/reset-database`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    showResult('resetResult',
                        `<span class="status-badge badge-success">âœ“ Ù†Ø¬Ø­</span>\n` +
                        `${data.message}\n\n` +
                        `Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:\n` +
                        `Username: ${data.admin.username}\n` +
                        `Password: ${data.admin.password}\n\n` +
                        `âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù† ÙØ§Ø±ØºØ© ÙˆÙ†Ø¸ÙŠÙØ©!`,
                        'success'
                    );
                    authToken = null; // Reset token
                } else {
                    showResult('resetResult',
                        `<span class="status-badge badge-error">âœ— ÙØ´Ù„</span>\n` +
                        `Ø§Ù„Ø±Ø³Ø§Ù„Ø©: ${data.detail}\n` +
                        `Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${response.status}`,
                        'error'
                    );
                }
            } catch (error) {
                showResult('resetResult',
                    `<span class="status-badge badge-error">âœ— Ø®Ø·Ø£</span>\n` +
                    `Ø§Ù„Ø®Ø·Ø£: ${error.message}`,
                    'error'
                );
            }
        }
    </script>
</body>

</html>